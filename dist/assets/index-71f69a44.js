var Bt=Object.defineProperty;var Gt=(n,i,s)=>i in n?Bt(n,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[i]=s;var m=(n,i,s)=>(Gt(n,typeof i!="symbol"?i+"":i,s),s),It=(n,i,s)=>{if(!i.has(n))throw TypeError("Cannot "+s)};var t=(n,i,s)=>(It(n,i,"read from private field"),s?s.call(n):i.get(n)),e=(n,i,s)=>{if(i.has(n))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(n):i.set(n,s)},a=(n,i,s,r)=>(It(n,i,"write to private field"),r?r.call(n,s):i.set(n,s),s),Ct=(n,i,s,r)=>({set _(h){a(n,i,h,s)},get _(){return t(n,i,r)}});(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))r(h);new MutationObserver(h=>{for(const o of h)if(o.type==="childList")for(const w of o.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&r(w)}).observe(document,{childList:!0,subtree:!0});function s(h){const o={};return h.integrity&&(o.integrity=h.integrity),h.referrerpolicy&&(o.referrerPolicy=h.referrerpolicy),h.crossorigin==="use-credentials"?o.credentials="include":h.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(h){if(h.ep)return;h.ep=!0;const o=s(h);fetch(h.href,o)}})();const c={fps:30,canvas:{width:256,height:220}},Mt=({context:n})=>({rectangle:({color:i,x:s,y:r,height:h,width:o})=>{n.beginPath(),n.fillStyle=i,n.fillRect(s,r,o,h)},image:({x:i,y:s,height:r,width:h,image:o,destinationX:w,destinationY:zt,destinationWidth:H,destinationHeight:A})=>{n.imageSmoothingEnabled=!1,n.drawImage(o,i,s,h,r,w,zt,H,A)},text:({color:i,x:s,y:r,text:h,fontSize:o})=>{n.font=`${o} Arial`,n.fillStyle=i,n.fillText(h,s,r)}});var f,g,x,p,y,ot,F,ct,Y,I,W,T,K,k,lt,S,pt,mt,vt,xt,yt;class Nt{constructor({context:i,car:s,track:r}){e(this,f,void 0);e(this,g,void 0);e(this,x,void 0);e(this,p,{height:c.canvas.height*.5,color:"#000044"});e(this,y,{color:"#9F6609",size:{min:t(this,p).height*.1,max:t(this,p).height*.9}});e(this,ot,new Array(c.canvas.height/2).fill(""));e(this,F,(c.canvas.height-t(this,p).height)/t(this,ot).length);e(this,ct,new Array(c.canvas.width).fill(""));e(this,Y,c.canvas.width/t(this,ct).length);e(this,I,{color:"#555555",width:c.canvas.width*1/2});e(this,W,{colors:["#20aa20","#20BB20"],frequency:60});e(this,T,{colors:["#AA0000","#FFFFFF"],width:t(this,I).width*.1,frequency:60});e(this,K,c.canvas.width);e(this,k,0);e(this,lt,1);e(this,S,0);e(this,pt,.4);e(this,mt,i=>{if(!t(this,x)||!t(this,g)||i<=t(this,x).coordinates[t(this,k)].distance)return;let s=t(this,k)+1;s>t(this,x).coordinates.length-1&&(s=0,Ct(this,lt)._++,t(this,g).positionOnTrack=0),a(this,k,s)});e(this,vt,(i,s)=>{if(!t(this,g))return;const r=Math.abs(i-s)>=.8;t(this,g).isOutOfTrack=r});e(this,xt,i=>{let s=0,r=-1;const o=1-r;return s=(i-r)*100/o/100,s});e(this,yt,i=>{const s=t(this,p).height*.015,r=t(this,xt).call(this,i);let h=t(this,y).size.min+r*t(this,p).height,o="up",w=0;t(this,ct).map((zt,H)=>{!t(this,f)||(o==="down"?h+=s:h-=s,h>t(this,y).size.max&&(h=t(this,y).size.max,o="up"),h<=t(this,y).size.min&&(h=t(this,y).size.min,o="down"),t(this,f).rectangle({color:t(this,p).color,x:w,y:0,width:t(this,Y),height:h}),t(this,f).rectangle({color:t(this,y).color,x:w,y:h,width:t(this,Y),height:t(this,p).height-h}),w=H+t(this,Y))})});m(this,"render",({deltaTime:i})=>{if(!t(this,g))return;const r=t(this,g).speed/100,h=t(this,g).positionOnTrack,o=t(this,g).position,w=t(this,k)===0?"#999":t(this,I).color;t(this,mt).call(this,h),t(this,yt).call(this,t(this,S)),t(this,ot).map((zt,H)=>{if(!t(this,f)||!t(this,g)||!t(this,x))return;const A=t(this,p).height+H*t(this,F);let C=H/(c.canvas.height/2);C=.05+C*.8;let At=t(this,x).coordinates[t(this,k)].curvature;At=At*t(this,pt);const Wt=At-t(this,S);a(this,S,t(this,S)+Wt*i*r/1200),t(this,vt).call(this,o,t(this,S));const Et=.5+t(this,S)*Math.pow(1-C,3),rt=t(this,K)*Et,Dt=t(this,I).width*C,D={...t(this,I),x:rt-Dt,width:Dt,color:w},nt=t(this,T).width*C,U={...t(this,T),color:Math.sin(t(this,T).frequency*Math.pow(1-C,2)+h*2)>0?t(this,T).colors[0]:t(this,T).colors[1],left:{x:rt-D.width-nt},right:{x:rt+D.width},width:nt},qt=t(this,K)/2-nt,$t=rt-D.width-nt,at={...t(this,W),width:qt,color:Math.sin(t(this,W).frequency*Math.pow(1-C,2)+h*2)>0?t(this,W).colors[0]:t(this,W).colors[1],right:{x:rt+D.width+nt},left:{width:$t}};t(this,f).rectangle({color:at.color,x:0,y:A,width:at.left.width,height:t(this,F)}),t(this,f).rectangle({color:U.color,x:U.left.x,y:A,width:U.width,height:t(this,F)}),t(this,f).rectangle({color:D.color,x:D.x,y:A,width:D.width*2,height:t(this,F)}),t(this,f).rectangle({color:at.color,x:at.right.x,y:A,width:t(this,K)-at.right.x,height:t(this,F)}),t(this,f).rectangle({color:U.color,x:U.right.x,y:A,width:U.width,height:t(this,F)})})});a(this,f,Mt({context:i})),a(this,g,s),a(this,x,r)}get trackSection(){return t(this,k)}get curvature(){return t(this,S)}get lap(){return t(this,lt)}}f=new WeakMap,g=new WeakMap,x=new WeakMap,p=new WeakMap,y=new WeakMap,ot=new WeakMap,F=new WeakMap,ct=new WeakMap,Y=new WeakMap,I=new WeakMap,W=new WeakMap,T=new WeakMap,K=new WeakMap,k=new WeakMap,lt=new WeakMap,S=new WeakMap,pt=new WeakMap,mt=new WeakMap,vt=new WeakMap,xt=new WeakMap,yt=new WeakMap;var E,q,dt,ut,ft,$,B,P,gt,_,l,G,Ft,kt,O,j,J,b,N,St;class Rt{constructor({context:i}){e(this,E,void 0);e(this,q,c.canvas.width*.25);e(this,dt,c.canvas.height*.2);e(this,ut,c.canvas.height-c.canvas.height*.22);e(this,ft,.5);e(this,$,2);e(this,B,0);e(this,P,0);e(this,gt,0);e(this,_,0);e(this,l,0);e(this,G,100);e(this,Ft,c.canvas.width/2);e(this,kt,c.canvas.width-t(this,q));e(this,O,!1);e(this,j,null);e(this,J,null);e(this,b,{width:63,height:34,idle:{x:0,y:0},left:{x:0,y:34},right:{x:0,y:68}});e(this,N,"idle");m(this,"turnLeft",()=>{if(t(this,l)<=0)return;a(this,N,"left");let i=t(this,P)-t(this,ft)*t(this,l)/1e3;i<-1&&(i=-1),a(this,P,i)});m(this,"turnRight",()=>{if(t(this,l)<=0)return;a(this,N,"right");let i=t(this,P)+t(this,ft)*t(this,l)/1e3;i>1&&(i=1),a(this,P,i)});m(this,"accelerate",i=>{let s=t(this,G);if(t(this,O)&&(s=t(this,G)/3),t(this,O)&&t(this,l)>s)return this.slowDown(i);t(this,$),t(this,O);let r=t(this,l)+t(this,$)*i;r>=t(this,G)&&(r=t(this,G)),this.speed=r});m(this,"slowDown",i=>{let s=0;const r=t(this,$)*2;s=t(this,l)-r*i,s<=0&&(s=0),this.speed=s});m(this,"break",i=>{let s=t(this,l)-t(this,$)*5*i;s<=0&&(s=0),this.speed=s});e(this,St,()=>t(this,b)[t(this,N)]);m(this,"render",({deltaTime:i,levelCurvature:s})=>{if(!t(this,E)||!t(this,j)||!t(this,J))return;a(this,B,t(this,P)-s*3);let r=t(this,Ft)+t(this,kt)*t(this,B)/2-t(this,q)/2;const h=t(this,St).call(this);t(this,E).image({image:t(this,j),height:t(this,b).height,width:t(this,b).width,y:h.y,x:h.x,destinationHeight:t(this,dt),destinationWidth:t(this,q),destinationX:r,destinationY:t(this,ut)}),t(this,O)&&t(this,E).image({image:t(this,J),height:t(this,b).height,width:t(this,b).width,y:h.y,x:h.x,destinationHeight:t(this,dt),destinationWidth:t(this,q),destinationX:r,destinationY:t(this,ut)});const o=t(this,l)/30*i;t(this,l)>0&&a(this,gt,t(this,gt)+o),a(this,_,t(this,_)+o)});a(this,E,Mt({context:i}));const s=new Image;s.src="./src/assets/images/car-white.png",s.onload=()=>{a(this,j,s)};const r=new Image;r.src="./src/assets/images/car-dirt.png",r.onload=()=>{a(this,J,r)}}get speed(){return t(this,l)}set speed(i){a(this,l,i)}get position(){return t(this,B)}set position(i){a(this,B,i)}get positionOnTrack(){return t(this,_)}set positionOnTrack(i){a(this,_,i)}get distanceTraveled(){return t(this,gt)}get isOutOfTrack(){return t(this,O)}set isOutOfTrack(i){a(this,O,i)}set carDirection(i){a(this,N,i)}}E=new WeakMap,q=new WeakMap,dt=new WeakMap,ut=new WeakMap,ft=new WeakMap,$=new WeakMap,B=new WeakMap,P=new WeakMap,gt=new WeakMap,_=new WeakMap,l=new WeakMap,G=new WeakMap,Ft=new WeakMap,kt=new WeakMap,O=new WeakMap,j=new WeakMap,J=new WeakMap,b=new WeakMap,N=new WeakMap,St=new WeakMap;var v,M,R;class Vt{constructor({context:i,car:s,level:r}){e(this,v,void 0);e(this,M,void 0);e(this,R,void 0);m(this,"render",({})=>{!t(this,v)||!t(this,M)||!t(this,R)||(t(this,v).text({color:"#FFFFFF",text:`Distance: ${Math.floor(t(this,M).distanceTraveled)}`,y:10,x:2,fontSize:"10px"}),t(this,v).text({color:"#FFFFFF",text:`Position: ${Math.floor(t(this,M).positionOnTrack)}`,y:20,x:2,fontSize:"10px"}),t(this,v).text({color:"#FFFFFF",text:`Speed: ${Math.floor(t(this,M).speed)}`,y:30,x:2,fontSize:"10px"}),t(this,v).text({color:"#FFFFFF",text:`Track section: ${Math.floor(t(this,R).trackSection)}`,y:40,x:2,fontSize:"10px"}),t(this,v).text({color:"#FFFFFF",text:`Lap: ${Math.floor(t(this,R).lap)}`,y:50,x:2,fontSize:"10px"}))});a(this,v,Mt({context:i})),a(this,M,s),a(this,R,r)}}v=new WeakMap,M=new WeakMap,R=new WeakMap;const Xt={name:"Test track",coordinates:[{curvature:0,distance:5},{curvature:0,distance:20},{curvature:1,distance:50},{curvature:0,distance:100},{curvature:-1,distance:150},{curvature:0,distance:200}]};var V,Q,X,wt,Z,tt,it,u,d,z,et,st,L,Ot,Lt,Tt,Pt,ht,bt;class Ht{constructor(){e(this,V,0);e(this,Q,0);e(this,X,c.fps);e(this,wt,t(this,X));e(this,Z,0);e(this,tt,1e3/c.fps);e(this,it,document.getElementById("canvas"));e(this,u,t(this,it).getContext("2d"));e(this,d,void 0);e(this,z,void 0);e(this,et,void 0);e(this,st,void 0);e(this,L,{});e(this,Ot,()=>{window.addEventListener("keydown",i=>{t(this,L)[i.key]=!0},!1),window.addEventListener("keyup",i=>{t(this,L)[i.key]=!1},!1)});e(this,Lt,i=>{!t(this,d)||(t(this,L).ArrowLeft?t(this,d).turnLeft():t(this,L).ArrowRight?t(this,d).turnRight():t(this,d).carDirection="idle",t(this,L).ArrowUp?t(this,d).accelerate(i):t(this,L).ArrowDown?t(this,d).break(i):t(this,d).slowDown(i))});e(this,Tt,()=>{t(this,u).beginPath(),t(this,u).rect(0,0,c.canvas.width,c.canvas.height),t(this,u).fillStyle="black",t(this,u).fill(),t(this,u).shadowBlur=0});e(this,Pt,i=>{!t(this,u)||!t(this,z)||!t(this,d)||!t(this,et)||!t(this,st)||(t(this,Tt).call(this),t(this,z).render({deltaTime:i}),t(this,d).render({deltaTime:i,levelCurvature:t(this,z).curvature}),t(this,et).render({deltaTime:i}),t(this,Lt).call(this,i),t(this,st).text({color:"#FFFFFF",text:`FPS: ${t(this,X)}`,y:10,x:c.canvas.width-50,fontSize:"10px"}))});e(this,ht,i=>{if(i<t(this,Q)+1e3/c.fps){requestAnimationFrame(t(this,ht));return}for(a(this,V,t(this,V)+(i-t(this,Q))),a(this,Q,i),i>t(this,wt)+1e3&&(a(this,X,.25*t(this,Z)+.75*t(this,X)),a(this,wt,i),a(this,Z,0)),Ct(this,Z)._++;t(this,V)>=t(this,tt);)a(this,V,t(this,V)-t(this,tt));t(this,Pt).call(this,t(this,V)/t(this,tt)),requestAnimationFrame(t(this,ht))});e(this,bt,()=>{t(this,ht).call(this,0)});m(this,"run",()=>{t(this,Ot).call(this),t(this,bt).call(this)});t(this,u).imageSmoothingEnabled=!1,t(this,it).width=c.canvas.width,t(this,it).height=c.canvas.height,a(this,d,new Rt({context:t(this,u)})),a(this,z,new Nt({context:t(this,u),car:t(this,d),track:Xt})),a(this,et,new Vt({context:t(this,u),car:t(this,d),level:t(this,z)})),a(this,st,Mt({context:t(this,u)}))}}V=new WeakMap,Q=new WeakMap,X=new WeakMap,wt=new WeakMap,Z=new WeakMap,tt=new WeakMap,it=new WeakMap,u=new WeakMap,d=new WeakMap,z=new WeakMap,et=new WeakMap,st=new WeakMap,L=new WeakMap,Ot=new WeakMap,Lt=new WeakMap,Tt=new WeakMap,Pt=new WeakMap,ht=new WeakMap,bt=new WeakMap;window.onload=function(){(()=>{new Ht().run()})()};
